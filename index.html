<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Movie Recommender - LLM + RAG + Two-Tower</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .query-section { background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 30px; }
        input[type="text"] { width: 70%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        .results { margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .explanation { font-style: italic; color: #555; font-size: 0.9em; }
        .metrics { background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .user-analysis { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .tab { overflow: hidden; border: 1px solid #ccc; background-color: #f1f1f1; border-radius: 5px; }
        .tab button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; }
        .tab button:hover { background-color: #ddd; }
        .tab button.active { background-color: #007bff; color: white; }
        .tabcontent { display: none; padding: 20px; border: 1px solid #ccc; border-top: none; border-radius: 0 0 5px 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Enhanced Movie Recommender</h1>
            <p>LLM + RAG + Two-Tower Architecture</p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'Enhanced')">üéØ LLM+RAG Enhanced</button>
            <button class="tablinks" onclick="openTab(event, 'Traditional')">‚ö° Traditional Two-Tower</button>
        </div>

        <!-- Enhanced LLM+RAG Tab -->
        <div id="Enhanced" class="tabcontent" style="display: block;">
            <div class="query-section">
                <h3>üîç Describe What You Want to Watch</h3>
                <input type="text" id="userQuery" placeholder="e.g., I want psychological thrillers with dark themes, no supernatural elements">
                <button onclick="getEnhancedRecommendations()">Get Enhanced Recommendations</button>
                <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    <strong>Example queries:</strong> 
                    "funny comedy movies with romance", 
                    "serious drama about family relationships",
                    "action movies with adventure themes"
                </div>
            </div>

            <div id="enhancedResults" class="results">
                <!-- Enhanced results will appear here -->
            </div>
        </div>

        <!-- Traditional Two-Tower Tab -->
        <div id="Traditional" class="tabcontent">
            <div class="query-section">
                <h3>üë§ Traditional User-Based Recommendations</h3>
                <input type="number" id="userId" placeholder="Enter User ID (e.g., 490)" min="1" max="1000">
                <button onclick="getTraditionalRecommendations()">Get Traditional Recommendations</button>
            </div>

            <div id="traditionalResults" class="results">
                <!-- Traditional results will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Enhanced Recommendations
        async function getEnhancedRecommendations() {
            const query = document.getElementById('userQuery').value;
            if (!query) {
                alert('Please describe what you want to watch');
                return;
            }

            const resultsDiv = document.getElementById('enhancedResults');
            resultsDiv.innerHTML = '<p>üîÑ Processing with LLM + RAG... (This would call your enhanced backend)</p>';

            // Simulate enhanced results (replace with actual API call)
            setTimeout(() => {
                displayEnhancedResults(query);
            }, 1000);
        }

        function displayEnhancedResults(query) {
            const resultsDiv = document.getElementById('enhancedResults');
            
            // Sample enhanced data structure
            const enhancedData = {
                query: query,
                search_criteria: {
                    intent: "psychological thriller",
                    preferred_genres: ["thriller", "drama"],
                    preferred_themes: ["psychological", "dark", "suspense"],
                    preferred_tone: "dark",
                    excluded_genres: ["supernatural"]
                },
                recommendations: [
                    {
                        title: "Silence of the Lambs",
                        score: 0.9234,
                        themes: ["investigation", "psychology", "manipulation"],
                        tone: "dark, intense",
                        explanation: "Matches your preference for psychological thrillers with dark themes and realistic tension",
                        year: 1991
                    },
                    {
                        title: "Se7en",
                        score: 0.8912,
                        themes: ["crime", "moral conflict", "investigation"],
                        tone: "dark, gritty",
                        explanation: "Dark atmosphere and psychological depth align with your interest in serious thrillers",
                        year: 1995
                    },
                    {
                        title: "Zodiac",
                        score: 0.8745,
                        themes: ["investigation", "obsession", "true crime"],
                        tone: "methodical, tense",
                        explanation: "Based on true events with realistic psychological tension, no supernatural elements",
                        year: 2007
                    },
                    {
                        title: "Prisoners",
                        score: 0.8567,
                        themes: ["family", "justice", "moral dilemma"],
                        tone: "dark, emotional",
                        explanation: "Psychological depth and dark themes match your preferences for intense drama",
                        year: 2013
                    },
                    {
                        title: "Gone Girl",
                        score: 0.8423,
                        themes: ["deception", "relationships", "mystery"],
                        tone: "dark, suspenseful",
                        explanation: "Complex psychological narrative with dark themes and realistic tension",
                        year: 2014
                    }
                ]
            };

            let html = `
                <h2>üéØ Recommendations for: "${enhancedData.query}"</h2>
                
                <div class="user-analysis">
                    <h3>üîç User Preference Analysis (LLM Processed)</h3>
                    <p><strong>Intent:</strong> ${enhancedData.search_criteria.intent}</p>
                    <p><strong>Preferred Genres:</strong> ${enhancedData.search_criteria.preferred_genres.join(', ')}</p>
                    <p><strong>Preferred Themes:</strong> ${enhancedData.search_criteria.preferred_themes.join(', ')}</p>
                    <p><strong>Preferred Tone:</strong> ${enhancedData.search_criteria.preferred_tone}</p>
                    <p><strong>Exclusions:</strong> ${enhancedData.search_criteria.excluded_genres.join(', ') || 'None'}</p>
                </div>

                <h3>üé¨ Top Recommended Movies</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Movie</th>
                            <th>Score</th>
                            <th>LLM Themes</th>
                            <th>LLM Tone</th>
                            <th>Explanation</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            enhancedData.recommendations.forEach((movie, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${movie.title}</strong> (${movie.year})</td>
                        <td>${movie.score.toFixed(4)}</td>
                        <td>${movie.themes.join(', ')}</td>
                        <td>${movie.tone}</td>
                        <td class="explanation">${movie.explanation}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
                
                <div class="metrics">
                    <h3>üìà Evaluation Metrics</h3>
                    <p><strong>Precision@5:</strong> 0.82 | <strong>Recall@5:</strong> 0.46 | <strong>NDCG@5:</strong> 0.85</p>
                    <p><strong>Improvement over traditional system:</strong> <span style="color: green; font-weight: bold;">+26%</span></p>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        // Traditional Recommendations (your existing functionality)
        async function getTraditionalRecommendations() {
            const userId = document.getElementById('userId').value;
            if (!userId) {
                alert('Please enter a User ID');
                return;
            }

            // This would call your existing traditional endpoint
            // For now, we'll simulate the traditional behavior
            displayTraditionalResults(userId);
        }

        function displayTraditionalResults(userId) {
            const resultsDiv = document.getElementById('traditionalResults');
            
            // Sample traditional data structure (your current output)
            const traditionalData = {
                user_id: userId,
                historical_ratings: [
                    { rank: 1, movie: "Dr. Strangelove", rating: 5, year: 1963 },
                    { rank: 2, movie: "Braindead", rating: 5, year: 1992 },
                    { rank: 3, movie: "Evil Dead II", rating: 5, year: 1987 }
                ],
                recommendations: [
                    { rank: 1, movie: "Major Payne", score: 1.5407, year: 1994 },
                    { rank: 2, movie: "Airheads", score: 1.3664, year: 1994 },
                    { rank: 3, movie: "Marked for Death", score: 1.3220, year: 1990 }
                ]
            };

            let html = `
                <h2>üìä Recommendations for User ${traditionalData.user_id}</h2>
                
                <h3>‚≠ê Top Rated Movies (Historical)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Movie</th>
                            <th>Rating</th>
                            <th>Year</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            traditionalData.historical_ratings.forEach(item => {
                html += `
                    <tr>
                        <td>${item.rank}</td>
                        <td>${item.movie}</td>
                        <td>${'‚≠ê'.repeat(item.rating)}</td>
                        <td>${item.year}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>

                <h3>üéØ Recommended Movies</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Movie</th>
                            <th>Score</th>
                            <th>Year</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            traditionalData.recommendations.forEach(item => {
                html += `
                    <tr>
                        <td>${item.rank}</td>
                        <td>${item.movie}</td>
                        <td>${item.score.toFixed(4)}</td>
                        <td>${item.year}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <p><strong>Note:</strong> This is the traditional Two-Tower system. Switch to the "LLM+RAG Enhanced" tab for the improved version with natural language queries and explanations.</p>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
